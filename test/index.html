<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>custom-elements-builtin</title>
  <script>
  try{customElements.define('built-in',document.createElement('p').constructor,{'extends':'p'})}
  catch(s){console.log('Safari ðŸŽ‰');document.write('<script src="../es.js"><\x2fscript>')}
  </script>
  <script>
  customElements.define('shadow-ed', class extends HTMLElement {
    constructor() {
      super();
      const snarky = this.attachShadow({mode: 'closed'});
      snarky.innerHTML = `
        <button is="shadow-button" test="shadowed">not really</button>
        <button is="lazy-button">not really</button>
      `;
    }
    connectedCallback() {
      console.log('shadow-ed', 'connected');
    }
    disconnectedCallback() {
      console.log('shadow-ed', 'disconnected');
    }
  });
  customElements.define(
    'shadow-button',
    class extends HTMLButtonElement {
      static get observedAttributes() { return ['test']; }
      constructor() {
        super().textContent = 'OK';
        console.log('shadow-button', 'constructed');
      }
      attributeChangedCallback(name, oldValue, newValue) {
        console.log('shadow-button', name, oldValue, newValue);
      }
      connectedCallback() {
        console.log('shadow-button', 'connected');
      }
      disconnectedCallback() {
        console.log('shadow-button', 'disconnected');
      }
    },
    {extends: 'button'}
  );
  this.onload = () => {
    const shadowed = document.createElement('shadow-ed');
    document.body.appendChild(
      document.createElement('button', {is: 'shadow-button'})
    );
    customElements.define(
      'lazy-button',
      class extends HTMLButtonElement {
        constructor() {
          super().textContent = 'OK';
        }
        connectedCallback() {
          console.log('lazy-button', 'connected');
        }
        disconnectedCallback() {
          console.log('lazy-button', 'disconnected');
        }
      },
      {extends: 'button'}
    );
    setTimeout(() => {
      document.querySelector('button[is="shadow-button"]').setAttribute('test', Math.random());
      document.body.append(shadowed, document.createElement('shadow-ed'));
      setTimeout(() => {
        document.body.textContent = '';
        setTimeout(() => {}, 100);
      }, 1000);
    }, 100);
  };
  try {
    const tag = 'div'
    const div = document.createElement(tag, {is: 'shadow-button'})
    const ShadowButton = customElements.get('shadow-button')
    console.assert(tag === div.localName, 'the div was not a div')
    console.assert(!(div instanceof ShadowButton), 'the div became a built-in')
  } catch (error) {
    console.error(error)
  }
  try {
    const tag = 'p'
    const div = document.createElement(tag, {is: 'not-really-p'})
    const ShadowButton = customElements.get('not-really-p')
    console.assert(tag === div.localName, 'the p was a not-really-p')
  } catch (error) {
    console.error(error)
  }
  </script>
</head>
<body>
  <button is="shadow-button"></button>
  <shadow-ed></shadow-ed>
</body>
</html>
